#!/bin/bash

#1.1.1 disable mounting of uncommon filesystems.

install freevxfs /bin/true
rmmod freevxfs

install jffs2 /bin/true
rmmod jffs2

install cramfs /bin/true
rmmod cramfs

install hfs /bin/true
rmmod hfs

install hfsplus /bin/true
rmmod hfsplus

install squashfs /bin/true
rmmod squashfs

install udf /bin/true
rmmod udf

#1.1.2, 1.1.3, 1.1.4 ensure /tmp is configured

systemctl unmask tmp.mount
systemctl enable tmp.mount

echo "[Mount]
What=tmpfs
Where=/tmp
Type=tmpfs Options=mode=1777,strictatime,noexec,nodev,nosuid" >> /etc/systemd/system/local-fs.target.wants/tmp.mount

mount -o remount,nodev /tmp
#1.1.21 disable stickeybit stuff
#I skipped 1.1.5 through 1.1.20 because they are irrelevant to cyberpatriot

df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d -perm -0002 2>/dev/null | xargs chmod a+t

#1.1.22 disable automounting

systemctl disable autofs

#Section numero threeo. Skipped two because it deals with Apt and other updates.

#1.3.1 file integrity stuff

apt-get install aide aide-common

aideinit

#1.3.2 edit cron to automate checking

echo "0 5 * * * /usr/bin/aide.wrapper --config /etc/aide/aide.conf --check" >> crontab -u root -e

#1.3.3

chown root:root /boot/grub/grub.cfg
chmod og-rwx /boot/grub/grub.cfg

